2007-01-16  Milan Zamazal  <pdm@brailcom.org>

	* pytis/data/postgresql.py (PostgreSQLConnector._pg_query): When
	calling the logging command, avoid duplicate locking resulting in
	deadlock.

2007-01-16  Tomas Cerha  <cerha@brailcom.org>

	* pytis/form/inputfield.py (InputField._on_set_focus): Only
	validate the previous field if it is from the same form.
	(Invocable._INVOKE_TITLE, Invocable._INVOKE_HELP)
	(Invocable._INVOKE_ICON): New constants.
	(Invocable._INVOKE_SELECTION_MENU_HELP)
	(Invocable._INVOKE_SELECTION_MENU_TITLE): Constants removed.
	(_call_next_method): Method removed.
	(Invocable._create_widget): Use `super()' instead of
	`_call_next_method()'.
	(Invocable._create_widget): `_INVOKE_SELECTION_MENU_TITLE' ->
	`_INVOKE_TITLE'.
	(Invocable._create_button): Use `wx.BitmapButton' when
	`self._INVOKE_ICON' is defined.
	(Invocable._disable, Invocable._enable): Use `super()' instead of
	`_call_next_method()'.
	(Invocable._menu): `_INVOKE_SELECTION_MENU_TITLE' ->
	`_INVOKE_TITLE'.  Use `super()' to get the parent class menu, not
	hardcoded `TextField' as the parent.
	(DateField._INVOKE_SELECTION_MENU_TITLE): -> `_INVOKE_TITLE'
	(DateField._INVOKE_SELECTION_MENU_HELP): -> `_INVOKE_HELP'
	(CodebookField._on_codebook_insert): Don't return anything.
	(ColorSelectionField._INVOKE_SELECTION_MENU_TITLE): ->
	`_INVOKE_TITLE'
	(ColorSelectionField._INVOKE_SELECTION_MENU_HELP): ->
	`_INVOKE_HELP'
	(CodebookField._INVOKE_SELECTION_MENU_TITLE): -> `_INVOKE_TITLE'
	(CodebookField._INVOKE_SELECTION_MENU_HELP): -> `_INVOKE_HELP'
	(CodebookField._create_widget): Use `super()' to create the base
	widget.  Use a 'new-record' icon instead of the plus sign on the
	codebook insertion button.
	(CodebookField._menu): Use `super()' to get the base menu.
	(FileField): Derive also from `Invocable'.
	(FileField._INVOKE_TITLE, FileField._INVOKE_HELP) 
	(FileField._INVOKE_ICON): New constants.
	(FileField._on_invoke_selection): New method.
	(FileField._menu): Use `Invocable's super class menu as base menu.

	* pytis/form/screen.py
	(get_icon): New function.
	(MItem.create): Use it.
	(MItem.__init__): Docstring updated.

	* pytis/form/commands_.py (DEFAULT_KEYMAP): Added keys for
	`FileField.COMMAND_CLEAR'.

	* pytis/web/__init__.py: Import `dialog'.

	* pytis/web/form.py (Form._valid_prefill): Don't omit key columns.
	(EditForm.export): Just print the identifier if the corresponding
	field does not exist.

	* pytis/web/dialog.py: New module.

	* pytis/data/types_.py (DateTime._check_format): Added regexps for
	`%p' format.

2007-01-15  Milan Zamazal  <pdm@brailcom.org>

	* pytis/data: New database API merged in.

2007-01-15  Milan Zamazal  <pdm@brailcom.org>

	* pytis/data/dbdata.py (DBConnectionPool.put_back): Use the right
	exception name when accessing the pool.

2007-01-15  Milan Zamazal  <pdm@brailcom.org>

	* pytis/form/application.py (has_access): Use
	default_access_groups instead of class_access_groups.

2007-01-15  Milan Zamazal  <pdm@brailcom.org>
	
	* pytis/util/caching.py (LimitedCache.__setitem__): Don't cache
	data in LimitedCache if the limit is 0.

2007-01-12  Tomas Cerha  <cerha@brailcom.org>

	* pytis/presentation/spec.py (Action.__init__): Docstring typo fix.

	* pytis/presentation/field.py (PresentedRow._init_row): Fixed bug
	in prefill initialization.

2007-01-11  Tomas Cerha  <cerha@brailcom.org>

	* pytis/form/dualform.py (DualForm.select_row): Pass the return
	value of the main form's method.

	* pytis/form/list.py (ListForm._select_row): Return `True' on
	success, `False' otherwise.
	(ListForm.select_row): Pass the return value of the
	parent class's method. 

	* pytis/form/form.py (RecordForm._on_new_record): Don't run
	callback `CALL_NEW_RECORD'.
	(RecordForm.select_row): Return `True' on success, `False' otherwise.
	(EditForm._select_row): Return `True'.
	(BrowsableShowForm._select_row): Pass the return value of the
	parent class's method.

2007-01-09  Tomas Cerha  <cerha@brailcom.org>

	* pytis/form/form.py (RecordForm._init_attributes): Docstring
	updated.

	* pytis/presentation/field.py (PresentedRow._init_row): Create a
	copy of the `prefill' dict with all values as new
	`pytis.data.Value' instances.  Use the same values regardless if
	`row' was None or not.
	(PresentedRow.__init__): Docstring updated.

2007-01-05  Tomas Cerha  <cerha@brailcom.org>

	* pytis/presentation/field.py (PresentedRow.display): Try to use
	columns own display prior to using CbComputer's display.

	* pytis/form/inputfield.py (InputField._on_set_focus): Validate
	last focused field only if it has the same parent -- is from the
	same form.
	(CodebookField._on_codebook_insert): Use `new_record' instead of
	`run_form'.

2007-01-04  Tomas Cerha  <cerha@brailcom.org>

	* pytis/form/application.py (Application._cmd_run_form): Removed
	hack for backwards compatibility of arguments.

2007-01-03  Tomas Cerha  <cerha@brailcom.org>

	* pytis/presentation/spec.py (FieldSpec.__init__): New argument
	`nocopy'.
	(FieldSpec.nocopy): New method.

	* pytis/form/form.py (RecordForm._row_copy_prefill): Also exclude
	computed fields which depend on key columns and fields with the
	`nocopy' flag.

2006-12-29  Tomas Cerha  <cerha@brailcom.org>

	* pytis/form/form.py (LookupForm._init_attributes): Removed
	argument `indicate_filter'.  Don't initialize
	`_lf_initial_condition'.
	(LookupForm._current_condition): New method.
	(LookupForm._init_select): Use it.
	(LookupForm._filter): Argument `condition' removed.
	(LookupForm._cmd_filter): Use `_lf_condition' instead of
	`_lf_initial_condition'.  Don't pass any arguments to `_filter'.
	(LookupForm._cmd_unfilter): Don't pass any arguments to `_filter'.
	(LookupForm.condition): Use `_current_condition' instead of
	`_lf_condition'.

	* pytis/form/list.py (CodebookForm._init_attributes): Don't
	process the `condition' argument here, leave it for parent class.
	(ListForm._update_label_colors): Don't use the `_indicate_filter'
	flag.  Indicate filter when `_lf_filter' is not None.
	(ListForm._filter): Removed
	(ListForm._find_row_by_values): Use `_current_condition' instead
	of `_lf_condition'.
	(ListForm._refresh): Recognize key `filter' for the `reset'
	argument.  Don't recognize `condition' and `filter_flag'.  Modify
	`_lf_filter', not `_lf_condition'.
	(ListForm._cmd_sort): Don't reset `condition'.
	(ListForm._cmd_autofilter): Use `_current_condition' instead of
	`_lf_condition'.
	(BrowseForm._formatter_parameters): Use `_current_condition'
	instead of `_lf_condition'.
	(FilteredBrowseForm.filter): Reset `filter', not `condition'.
	Reinitialize `_lf_condition', not `_lf_initial_condition'.

2006-12-28  Tomas Cerha  <cerha@brailcom.org>

	* pytis/presentation/spec.py (Specification._create_data_spec):
	Added assertion to disable setting `access_rights' for a `MemData'
	data object.

	* ChangeLog.3: New file.

	* ChangeLog: Records prior to 2006-12-13 saved to `ChangeLog.3'.

	* pytis/form/dualform.py (DualForm.help_name): Condition for
	adding the `-dual' suffix fixed.

	* pytis/form/inputfield.py (EnumerationField._choices): Set only
	the relevant `FieldSpec' attributes for the fake `PresentedRow'.

	* pytis/util/configuration.py
	(Configuration._Option_auto_reload_defs.default): Option removed.

	* pytis/util/resolver.py (Resolver.__init__): Ignore configuration
	option `auto_reload_defs'.  Always cache modules.
	(Resolver): Docstring updated.

2006-12-27  Tomas Cerha  <cerha@brailcom.org>

	* pytis/form/_grid.py (IncrementalSearch._exit): Call
	`self._set_row' when `self._listform' is alive.

2006-12-23  Tomas Cerha  <cerha@brailcom.org>

	* pytis/data/types_.py (String._export, Value._init): Make unicode
	conversion only when the object is not a unicode object yet.

	* pytis/presentation/spec.py (ViewSpec.__init__): Docstring updated.

	* pytis/web/form.py (BrowseForm._export_field):
	`lcg.TranslatableText' -> `lcg.Localizable'.

2006-12-20  Tomas Cerha  <cerha@brailcom.org>

	* pytis/form/application.py (Application._cmd_run_procedure): New
	argument `enabled'.
	(Application._can_run_procedure): New method.

